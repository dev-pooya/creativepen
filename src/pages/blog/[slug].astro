---
import Accordion from "@/components/Accordion.astro";
import Header from "@/components/Header.astro";
import MobileHeader from "@/components/MobileHeader.astro";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import Layout from "@/layouts/Layout.astro";
import Footer from "@/sections/Footer.astro";
import { getCollection, getEntry } from "astro:content";

// Fetch the paths for all services
export async function getStaticPaths() {
  const blogs = await getCollection("blogs");

  return blogs.map((blog) => ({
    params: { slug: blog.slug },
  }));
}

const { slug } = Astro.params;

// Fetch the service entry for the given slug
const blog = await getEntry("blogs", slug);

if (!blog) {
  throw new Error(`blog not found: ${slug}`);
}

// Render the Markdown content and headings
const { Content } = await blog.render();

const { title, thumbnail, tags, headings } = blog.data;
---

<Layout title={title}>
  <Header />
  <MobileHeader />
  <main class="sm:pt-20">
    <div class="max-w-screen-xl mx-auto p-5 md:grid md:grid-cols-4 md:gap-6">
      <div class="mx-auto md:w-1/2 col-span-4">
        <img src={thumbnail} class="w-full rounded-xl" />
      </div>
      <h1
        class="colored-title text-5xl leading-tight font-medium md:text-center py-6 col-span-4"
      >
        {title}
      </h1>
      <article class="col-span-3 border-r-4 pr-3">
        <Content />
      </article>
      <aside class="hidden md:block">
        <Card className="p-3 sticky top-20">
          <ul class="flex flex-col gap-3">
            {
              headings.map((heading) => (
                <li class="font-medium  py-3">
                  <a href={`#${heading.id}`}> {heading.title}</a>
                  {heading.subHeadings && (
                    <ul class="">
                      {heading.subHeadings.map((sub) => (
                        <li class="pr-4 text-sm py-1">
                          <a href={`#${sub.id}`}>- {sub.title}</a>
                        </li>
                      ))}
                    </ul>
                  )}
                </li>
              ))
            }
          </ul>
        </Card>
      </aside>
    </div>
  </main>
  <Footer />
</Layout>
